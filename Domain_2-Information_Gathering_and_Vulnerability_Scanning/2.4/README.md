
# 2.4 - Given a scenario, perform vulnerability scanning.

## Vulnerability Lifecycle:


|Stage | Description|
|--|--|
|1. Discover|* Recognizing/finding a potential vulnerability that exists and can be exploited.|
| 2. Coordinate |* The vulnerability is known (as well as the potential for it to be exploited).|
|3. Mitigate|* Analysts inspect the vulnerability. And devise a strategy to deal with the vulnerability. |
|4. Manage|*  Occurs when the patch has been released. It's now up to each organization to take the next step and apply the patch in order to remediate or mitigate the vulnerability. |
|5. Document|* The vulnerability has been tested, and the team will document what has been done. |

## Considerations of vulnerability scanning: 
* A vulnerability scanner will scan a system for known vulnerabilities. Make sure your scanner is always up-to-date → Updated with new signatures from feeds, SCAP data, etc.
* ***Time to run scans*** -- Daily / Weekly / Monthly. Don’t run scans during production hours.
* ***Protocols*** -- In the scope, it may include a list of protocols to either target or avoid. 
	* Networking protocols (TCP, UDP), application protocols, etc. (HTTP, NTP, …).
* ***Network topology*** -- Maybe there’s a segmented network, and you only desire to scan a portion of the network. 
	* IP range, CIDR (192.168.0.0/24), websites to scan. 
* ***Bandwidth limitations*** -- May depend on the network speed. You may want to throttle back → to avoid taking down the network with too many queries (also, to avoid detection).  
* ***Query throttling*** -- Set scan settings to avoid detection.
* ***Fragile systems*** -- Some systems may not be able to handle scans. Performing scans on these systems could cause them to crash/break. 
	* If the system/app is older and less robust than modern systems. 
	* You may need to perform a manual/custom scan on these systems, or consider excluding fragile systems from your scans. 
* ***Non-traditional assets*** -- 
	* A custom/non-standard system that was introduced into the network. 
	* Ex. a non-standard medical device, or IoT device.
		* That developer will need to provide technical support if/when an issue occurs. 

## Scan identified targets for vulnerabilities:
* To first identify targets, do a discovery scan (or ping sweep).
* Once live hosts are identified, the next step is to run a port scan to see if any live hosts have ports that are [1] open and [2] listening. 
	* The scan can either attempt to fully connect with the host, or they can use a stealth scan so they can remain undetected.
* Vulnerability scanners will check for new and existing vulnerabilities. 

## Scanning methods:
* ***Stealth scan*** -- Scan settings are set to avoid detection. The communication is one-sided, and no response is expected.
* ***TCP connect scan***: It's a FULL connection that is very noisy.
* ***Credentialed vs. Non-Credentialed***:
	* *Credentialed* -- PenTester is given credentials by the client. Use creds in the scan. You can act as an internal threat. Produce more information.
	* *Non-Credentialed* -- You don’t have credentials, so you must rely on traditional black-hat tactics. You act as an external threat. You may only find missing patches or updates. 

## Vulnerability testing tools that facilitate automation: 
* Anything that allows scripting or API capabilities  → should allow the option to provide automation for scanning. Automating scans can save you time (they're fast, repeatable, and customizable).
	* Modern → Nessus has a helpful GUI that allows you to set up automation.
	* Traditional → writing scripts. Using a CLI scanner, should provide automation script options.

## Nmap: 
* “Network Mapper”. It's the most widely-used network scanner.  
	* Target selection: `nmap <TARGET>`
	* Host and service discovery; OS fingerprinting; Versioning; Gathering MAC addresses; Detect vulnerable hosts.
	* Finds holes in a target’s defense. Gain access into remote target systems. 

|Port states| Description|
|--|--|
|1. Open|Responds to probes: YES; Accepts connection: YES.|
|2. Closed | Responds to probes: YES (RST); But the port itself is NOT reachable. |
|3. Filtered | Nmap concludes that the port is being blocked by a **firewall** |

* ***Zenmap*** -- GUI version of Nmap. Includes dropdowns. 
* ***NSE (Nmap Scripting Engine) scripts*** -- NSE scripts extend the functionality of Nmap. Allows users to customize activity and automate the scanning process. 
	* Scan for vulnerabilities; Extensive script library.
	* `--script = <SCRIPT_NAME>`     (to run a specific script)
* *Common options*:      (`nmap <OPTIONS> <TARGET>`)
	* Scanning types → 
		* `-sS` -- Stealth scan. Default Nmap scan. Fast and quiet scan. 
		* `-sT` -- Full TCP scan. Slow and noisy scan, but you will know if a port is open/closed.
		* `-sU` -- UDP scan. It takes a while to run. Only used if you don't see anything on a `-sS` and `-sT` scan
	* Port Specification → 
		* `-p` -- A specific port (or port range) is specified. Or, you could use `-p-` to specify all ports. 
	* Timing & Ping → 
		* ` -T <1-5>` -- Timing options. `-T1` is the slowest and quietest, while `-T5` is the fastest and noisiest. `-T3` is the default speed of Nmap.
		* `-Pn` -- NO ping. Skips the initial ping scan that Nmap performs. This switch is used for when you already assume that a host is up, so it skips straight to the routine scanning. This is also used since firewalls will block all ICMP packets. 
	* Detection (OS or Version) → 
		* `-O` -- OS detection.
		* `-sV` -- Version detection.
	* Miscellaneous → 
		* `-A` -- Aggressive scan. This scan enables [1] OS detection, [2] version detection, [3] script scanning, and [4] traceroute. Performing `-A` on every port will take a long time, so scan for open ports first and then re-scan with `-A` on individual ports.
		* `--script=vuln` -- scan for EVERY vulnerability (which Nmap is aware of) against a target. 
